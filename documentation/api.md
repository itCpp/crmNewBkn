# API

- [Информация для БАЗЫ](/documentation/base.md)

## Общие запросы

### Обработка входящего события
`POST` `GET` `/api/events/{type?}`

| Параметр | Тип | Обязательный | Описание |
| ------ | ------ | ------ | ------ |
| `type` | `string` | _Нет_ | Тип входящего события `call_asterisk`, `callDetailRecord`, `coming` |

##### Обработка входящего события на добавление заявки
`POST` `GET` `/api/events`

Обязательно должен быть хотя бы один параметр `text` или `call`
| Параметр | Тип | Обязательный | Описание |
| ------ | ------ | ------ | ------ |
| `text` | `int` | _Да или_ | Идентификатор входящего события текстовой заявки |
| `call` | `int` | _Да или_ | Идентификатор входящего события звонка |

##### Обработка входящего события внутреннего Asterisk
`POST` `GET` `/api/events/call_asterisk`

| Параметр | Тип | Обязательный | Описание |
| ------ | ------ | ------ | ------ |
| `call_id` | `int` | _Да_ | Идентификатор входящего события звонка |

##### Обработка входящего события окончания разговора
`POST` `GET` `/api/events/callDetailRecord`

| Параметр | Тип | Обязательный | Описание |
| ------ | ------ | ------ | ------ |
| `event_id` | `int` | _Да_ | Идентификатор входящего события звонка |
| `phone` | `string` | _Да_ | Номер телефона |
| `extension` | `string` | _Да_ | Внутренний номер |
| `path` | `string` | _Да_ | Путь до расположения файла аудиозаписи |
| `call_at` | `string` | _Нет_ | Время звонка |
| `type` | `string` | _Нет_ | Тип звонка, исходящий или входящий |
| `duration` | `int` | _Нет_ | Длина аудио |

##### Установка статуса прихода для заявки
`POST` `GET` `/api/events/coming`

| Параметр | Тип | Обязательный | Описание |
| ------ | ------ | ------ | ------ |
| `id` | `int` | _Да_ | Номер заявки |

### Получить номер телефона через идентификатор
`POST` `GET` `/api/getNumberFromId`

Получает номер телефона в формате `89001234567` по идентификатору заявки и клиента.
Для заявки используется связка номера заявки и номера клинета в формате `+123456s654321`, для получение номера из договора, необходимо передать значение `+7000d0`, где `7000` - идентификатор договора и `0` - порядковый номер расположения номера телефона в списке номеров

Стоит помнить, что для доступа к выполнению данного метода необходимо указать адреса устройств, которым разрешен вывод номера телефона. Для этого в `.env` файле можно перечислить адреса через запятую для следующей переменной:
```sh
ASTERISK_ACCESS_IPS=127.0.0.1,127.0.0.2
```

В случае отсутствия номера телефона по переданными параметрам, сервер вернет стандартный номер телефона `1100`. Чтобы указать другой номер-пустышку, необходимо изменить значение переменной `ASTERISK_EMPTY_EXTENSION` в `.env` файле

| Параметр | Тип | Обязательный | Описание |
| ------ | ------ | ------ | ------ |
| `number` | `string` | _Да_ | Идентификатор заявки и клиента или договора и порядкового номера телефона в договоре |
